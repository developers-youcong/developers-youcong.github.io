---
title: 《设计模式之禅》之观察者模式
date: 2020-03-15 15:15:57
tags: "读书笔记"
---

## 一、观察者模式的定义
观察者模式也叫做发布订阅模式，它是一个在项目中经常使用的模式，其定义如下:
**定义对象间一种一对多的依赖关系，使得没当一个对象改变状态，则所有依赖于它的对象都会得到通知并被自动更新。**
<!--more-->
### 观察者模式的几种角色名称:


#### (1)Subject被观察者
定义被观察者必须实现的职责，它必须能够动态地增加、取消观察者。它一般是抽象类或者实现类，仅仅完成作为被观察者必须实现的职责:管理观察者并通知观察者。


#### (2)Observer观察者
观察者接收到消息后，即进行update(更新方法)操作，对接收到的信息进行处理。

#### (3)ConcreteSubject具体的被观察者
定义被观察者自己的业务逻辑，同时定义对哪些事件进行通知。

#### (4)ConcreteObject具体的观察者
每个观察在接收到消息后的处理反应是不同的，各个观察者有自己的处理逻辑。


## 二、观察者模式的应用

### 1.观察者模式的优点
(1)观察者和被观察者之间是抽象耦合

(2)建立一套触发机制

### 2.观察者模式的缺点
观察者模式需要考虑一下开发效率和运行效率问题，一个被观察者，多个观察者，开发和调试就会比较复杂，而且在Java中消息的通知默认是顺序执行，一个观察者卡壳，会影响整体的执行效率。在这种情况下，一般考虑采用异步的方式。

### 3.观察者模式的使用场景
- 关联行为场景。需要注意的是，关联行为是可拆分的，而不是"组合"关系。
- 事件多级触发场景。
- 跨系统的消息交换场景，如消息列的处理机制。


### 4.观察者模式的注意事项
(1)广播链的问题

**注意:**它和责任链模式的最大区别就是观察者广播链在传播的过程中消息是随时更改的，它是有相邻的两个节点协商的消息结构;而责任链模式在消息传递过程中基本上保持消息不可变，如果要改变，也只是在原有的消息上进行修正。

(2)异步处理问题
针对观察者比较多，处理时间较长，使用异步，异步处理就要考虑线程安全和队列的问题，如消息队列。


## 三、最佳实践
观察者模式在实际项目和生活中非常常见，我们举例子说明。

### 1.文件系统
比如，在一个目录下新建立一个文件，这个动作会同时通知目录管理器增加该目录，并通知磁盘管理器减少1KB的空间，也就是说"文件"是一个被观察者，"目录管理器"和"磁盘管理器"则是观察者。

### 2.猫鼠游戏
夜里猫叫一声，家里老鼠撒腿就跑，同时也吵醒了熟睡的主人，这个场景中,"猫"就是被观察者，老鼠和人则是观察者。

### 3.ATM取钱
你到ATM机器上取钱，多次输错密码，卡就会被ATM吞掉，吞卡动作发生的时候，会触发哪些事件？

第一，摄像头连续快拍

第二，通知监控系统，吞卡发生

第三，初始化ATM机屏幕，返回最初状态

一般前两个动作都是观察者模式来完成的，后一个动作是异常来完成的。

### 4.广播收音机
电台在广播，你可以打开一个收音机，或者两个收音机来收听，电台就是被观察者，收音机就是观察者。

代码例子:
https://github.com/developers-youcong/DesignPatternPractice/tree/master/ObServer